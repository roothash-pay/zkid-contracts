# ğŸ§© zkIDï¼šåŸºäº BN254 çš„å±æ€§çº§èº«ä»½è¯æ˜ä½“ç³»

> **zkID** æ˜¯ä¸€ä¸ªåŸºäº **BN254 æ¤­åœ†æ›²çº¿** çš„é“¾ä¸Š KYCï¼ˆKnow Your Customerï¼‰è§£å†³æ–¹æ¡ˆï¼Œç»“åˆ **BLS å¤šèŠ‚ç‚¹ç­¾å**ã€**Poseidon å“ˆå¸Œæ‰¿è¯º** ä¸ **ZK-SNARK é›¶çŸ¥è¯†è¯æ˜**ï¼Œå®ç°å»ä¸­å¿ƒåŒ–ã€å¯éªŒè¯ã€éšç§ä¿æŠ¤çš„èº«ä»½è®¤è¯ä½“ç³»ã€‚

---

## ğŸ¯ 5.1 è®¾è®¡ç›®æ ‡

**zkID** çš„ç›®æ ‡æ˜¯æ„å»ºä¸€ç§ **å¯éªŒè¯**ã€**éšç§ä¿æŠ¤**ã€**å¯æ‰©å±•** çš„å»ä¿¡ä»»åŒ–èº«ä»½ç³»ç»Ÿã€‚

ç”¨æˆ·åœ¨å®Œæˆé“¾ä¸‹ KYC å®åè®¤è¯åï¼Œå¯ä»¥åœ¨ **ä¸æ³„éœ²ä»»ä½•ä¸ªäººéšç§ä¿¡æ¯** çš„å‰æä¸‹ï¼Œ  
å‘ä»»æ„é“¾ä¸Šä¸šåŠ¡åˆçº¦è¯æ˜è‡ªå·±æ»¡è¶³æŸé¡¹å±æ€§æ¡ä»¶ï¼ˆä¾‹å¦‚ã€Œå¹´é¾„ â‰¥ 18 å²ã€ï¼‰ã€‚

è¯¥ç³»ç»Ÿç»“åˆï¼š
- **BN254 æ¤­åœ†æ›²çº¿**ï¼šæä¾›é«˜æ•ˆé…å¯¹éªŒè¯ï¼›
- **BLS èšåˆç­¾å**ï¼šç¡®ä¿ Oracle å±‚çš„å»ä¸­å¿ƒåŒ–å¯ä¿¡ï¼›
- **ZK-SNARK ç”µè·¯**ï¼šåœ¨ä¸å…¬å¼€åŸå§‹ä¿¡æ¯çš„æƒ…å†µä¸‹å®Œæˆå±æ€§è¯æ˜ã€‚

> **æ ¸å¿ƒæ€æƒ³ï¼š**
> - ğŸŸ£ Oracle è¯´çœŸè¯ï¼ˆç­¾åï¼‰  
> - ğŸŸ¢ ç”¨æˆ·è‡ªå·±ç®—ï¼ˆç”Ÿæˆ zk-proofï¼‰  
> - ğŸ”µ é“¾ä¸ŠéªŒç»“æœï¼ˆpairing + verifierï¼‰

---

## ğŸ§± 5.2 ç³»ç»Ÿè§’è‰²

1. **ç”¨æˆ·ï¼ˆUserï¼‰**ï¼šæäº¤éšç§ä¿¡æ¯ã€ç”Ÿæˆé›¶çŸ¥è¯†è¯æ˜ã€‚  
2. **Oracleï¼ˆID Oracleï¼‰**ï¼šå®Œæˆé“¾ä¸‹ KYC éªŒè¯ï¼Œå¹¶åŸºäºç»“æœç”Ÿæˆæ‰¿è¯ºç‚¹ä¸ BLS ç­¾åã€‚  
3. **Verifier åˆçº¦**ï¼šåœ¨é“¾ä¸ŠéªŒè¯ Oracle ç­¾ååŠ zk-proofï¼Œæœ‰æ•ˆåˆ¤æ–­ç”¨æˆ·æ˜¯å¦æ»¡è¶³ç‰¹å®šå±æ€§ã€‚

---

## ğŸ”„ 5.3 ç³»ç»Ÿæ€»ä½“æµç¨‹

zkID ç³»ç»Ÿç”±ä¸‰å±‚ç»„æˆï¼š

| å±‚çº§ | ä¸»è¦èŒè´£ |
|------|-----------|
| **Oracle ç­¾å‘å±‚** | è´Ÿè´£ç”Ÿæˆ BN254 æ‰¿è¯ºç‚¹ï¼ˆPï¼‰å¹¶å¯¹å…¶ç­¾åï¼› |
| **ç”¨æˆ·è¯æ˜å±‚** | åŸºäºç§å¯†ä¿¡æ¯ç”Ÿæˆ zk-proofï¼› |
| **é“¾ä¸ŠéªŒè¯å±‚** | éªŒè¯ Oracle ç­¾åä¸ zk-proof çš„æœ‰æ•ˆæ€§ã€‚ |

---

### ğŸ§© æ•´ä½“æ•°æ®æµ

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ç”¨æˆ·     â”‚       â”‚  ID Oracle  â”‚       â”‚   Verifieråˆçº¦   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
     â”‚ æäº¤èº«ä»½ä¿¡æ¯              â”‚                       â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
     â”‚                          â”‚ ç”Ÿæˆ P = H2C(Poseidon(m, r))
     â”‚                          â”‚ ç­¾å Ïƒ = Sign(sk, Hash(P, policy))
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
     â”‚ è·å¾— (P, Ïƒ, policy)       â”‚                       â”‚
     â”‚ ç”Ÿæˆ zk-proof(m, r, P)                           â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                          â”‚ éªŒç­¾ e(Ïƒ, g2) == e(P, pk)
     â”‚                          â”‚ éªŒè¯ zk-proof verifyProof(P)
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚             âœ… éªŒè¯é€šè¿‡                          â”‚

```

## âš™ï¸ 6. æ¶æ„å®ç°

### 6.1 æ€»ä½“æ¶æ„

#### 1. Oracle æœåŠ¡ï¼ˆGoï¼‰

Oracle æ˜¯ç³»ç»Ÿçš„æƒå¨ç­¾å‘è€…ï¼Œè´Ÿè´£ä¸ºç”¨æˆ·çš„èº«ä»½å±æ€§ç”Ÿæˆ BN254 æ‰¿è¯ºç‚¹ä¸ç­¾åã€‚

- ä½¿ç”¨ `gnark-crypto` å®ç° BN254 æ¤­åœ†æ›²çº¿ã€é…å¯¹ã€Poseidon å“ˆå¸Œï¼›
- è®¡ç®—ï¼š

h = Poseidon(did, m, r, policy_id, version)

- å°† `h` å“ˆå¸Œåˆ° G1 æ›²çº¿ç‚¹ï¼š
P = HashToCurve_BN254(h)

- ä½¿ç”¨ Oracle ç§é’¥ç­¾åï¼š
Ïƒ = sk_oracle * P // G1 ç­¾å
pk = sk_oracle * g2 // G2 å…¬é’¥

- è¿”å›ç»™ç”¨æˆ·ï¼š

---

#### 2. è¯æ˜ç«¯ Proverï¼ˆGoï¼‰

Prover è´Ÿè´£åœ¨é“¾ä¸‹æ„å»ºå¹¶ç”Ÿæˆé›¶çŸ¥è¯†è¯æ˜ï¼Œè¯æ˜ç”¨æˆ·çš„å±æ€§æ»¡è¶³ç‰¹å®šæ¡ä»¶ã€‚

- ä½¿ç”¨ `gnark` æ„å»ºç”µè·¯çº¦æŸï¼š
```go
h' = Poseidon(did, m, r, policy_id, version)
P' = H2C(h')
assert(P' == P)
assert(m.age >= threshold)
```

ä½¿ç”¨ Groth16 ç”Ÿæˆ ZK è¯æ˜ï¼š

proof = groth16.Prove(circuit, witness)


å°† proof + public inputs (P.x, P.y, threshold[, did â€¦]) ä¸Šä¼ é“¾ä¸Šè¿›è¡ŒéªŒè¯ã€‚

#### 3. é“¾ä¸Šï¼ˆSolidityï¼‰

é“¾ä¸Šé€šè¿‡ Oracle ç­¾åéªŒè¯ä¸ ZK éªŒè¯å™¨åˆçº¦å®Œæˆæœ€ç»ˆæ ¡éªŒã€‚

- OracleSigVerifier.sol

ä½¿ç”¨ EVM é¢„ç¼–è¯‘çš„ BN254 pairing éªŒè¯ Oracle ç­¾åï¼š

pairing(Ïƒ, g2) == pairing(P, pk_oracle)


- Groth16Verifier.sol

ç”± gnark æˆ– snarkjs è‡ªåŠ¨ç”Ÿæˆçš„ ZK è¯æ˜éªŒè¯å™¨ï¼›

éªŒè¯ Prover ç”Ÿæˆçš„è¯æ˜æœ‰æ•ˆæ€§ã€‚

- PolicyRouter.sol

æ•´åˆä¸¤æ­¥éªŒè¯é€»è¾‘ï¼šå…ˆéªŒç­¾ï¼Œå†éªŒ ZKï¼›

ä¸šåŠ¡åˆçº¦åªéœ€ä¾èµ–éªŒè¯ç»“æœå³å¯å®Œæˆè®¿é—®æ§åˆ¶ã€‚

### ğŸ§© æŠ€æœ¯é€‰å‹ï¼ˆGo ä¾§ï¼‰

- æ¨¡å—	æŠ€æœ¯æ ˆ / åº“ Groth16 / BN254ï¼‰
- ç”µè·¯ / è¯æ˜	gnark
- æ¤­åœ†æ›²çº¿ / é…å¯¹	gnark-crypto/ecc/bn254

- Poseidon å“ˆå¸Œ	gnark-crypto/ecc/bn254/fr/poseidon æˆ– gnark/std/hash/poseidon
- Hash-to-Curve	
æ–¹æ¡ˆAï¼ˆæ¨èï¼‰ï¼šç”µè·¯ä¸­å®ç° ZK å‹å¥½ H2Cï¼ˆç®€åŒ– SWU / try-and-incrementï¼‰

æ–¹æ¡ˆBï¼ˆå¿«é€ŸåŸå‹ï¼‰ï¼šé™å®š 2~3 æ¬¡ try-and-incrementï¼Œå¤±è´¥è·¯å¾„ç”¨é€‰æ‹©å™¨å±è”½

âš ï¸ æ³¨æ„ï¼šOracle ä¸ç”µè·¯ä¸­å¿…é¡»ä½¿ç”¨å®Œå…¨ä¸€è‡´çš„ HashToCurve è§„åˆ™ä»¥ç¡®ä¿éªŒè¯ä¸€è‡´æ€§ã€‚

ğŸ§± ç³»ç»Ÿåˆ†å±‚èŒè´£
å±‚çº§	æ¨¡å—	èŒè´£
Oracle å±‚	Oracle Service	è´Ÿè´£ç­¾å‘å±æ€§æ‰¿è¯ºä¸ç­¾å
è¯æ˜å±‚	Prover	ç”Ÿæˆé›¶çŸ¥è¯†è¯æ˜ï¼Œé“¾ä¸‹æ‰§è¡Œ
é“¾ä¸Šå±‚	PolicyRouter.sol, OracleRegistry, Groth16Verifier	ç»Ÿä¸€ç­–ç•¥éªŒè¯å…¥å£ï¼Œå®Œæˆé“¾ä¸ŠéªŒç­¾ä¸éªŒ ZK

ğŸ”’ ä¿¡ä»»æ¨¡å‹ä¸€è§ˆ
```text
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚        zkID System         â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ æ³¨å†Œ ORACLE_PK + Verifier
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ID Oracle      â”‚        â”‚  User/DApp Proverâ”‚
â”‚  (æƒå¨ç­¾å‘è€…)    â”‚        â”‚ (ç”Ÿæˆ ZK è¯æ˜)   â”‚
â”‚  æŒæœ‰ oracleSK   â”‚        â”‚ è°ƒç”¨ gnark ç”Ÿæˆ   â”‚
â”‚  è´Ÿè´£ç­¾å Ïƒ      â”‚        â”‚ proof            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                           â”‚
         â”‚  (P, Ïƒ, h, policy,ver)    â”‚  proof + public inputs
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚     PolicyRouter.sol   â”‚
               â”‚  â”œâ”€ OracleSigVerifier  â”‚
               â”‚  â”œâ”€ Verifier_AgeGE_V1  â”‚
               â”‚  â””â”€ OracleRegistry     â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

### ğŸ“š å¼€å‘æŒ‡å¼•

Go ç¯å¢ƒ
```
go get github.com/ConsenSys/gnark
go get github.com/ConsenSys/gnark-crypto
```

ç”µè·¯ç¼–è¯‘
```
go run main.go build-circuit
```

è¯æ˜ç”Ÿæˆ
```
go run main.go prove
```

Solidity éªŒè¯
```
forge test
```

### ğŸ“– å‚è€ƒ

ConsenSys gnark Documentation

Ethereum Precompiles â€” EIP-197: Pairing

Poseidon Hash Function

Hash-to-Curve Standard (IETF Draft)

### Author: Vant liber
zkID Â· åŸºäºé›¶çŸ¥è¯†çš„éšç§èº«ä»½ç³»ç»Ÿ

ã€ŒOracle è¯´çœŸè¯ï¼Œç”¨æˆ·è‡ªå·±ç®—ï¼Œé“¾ä¸ŠéªŒç»“æœã€


---